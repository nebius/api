syntax = "proto3";

package nebius.compute.v1;

import "buf/validate/validate.proto";
import "google/protobuf/timestamp.proto";
import "nebius/annotations.proto";
import "nebius/common/v1/metadata.proto";

option go_package = "github.com/nebius/gosdk/proto/nebius/compute/v1";
option java_multiple_files = true;
option java_outer_classname = "ImageProto";
option java_package = "ai.nebius.pub.compute.v1";

message Image {
  common.v1.ResourceMetadata metadata = 1;

  ImageSpec spec = 2;

  ImageStatus status = 3;
}

message ImageSpec {
  enum CPUArchitecture {
    UNSPECIFIED = 0;

    AMD64 = 1;

    ARM64 = 2;
  }

  optional string description = 1 [
    (field_behavior) = IMMUTABLE,
    deprecated = true,
    (field_deprecation_details) = {
      effective_at: "2026-01-01"
      description: "The field is empty"
    }
  ];

  string image_family = 2 [(field_behavior) = IMMUTABLE];

  // part of identifier into the image family
  string version = 3 [(field_behavior) = IMMUTABLE];

  oneof source {
    option (buf.validate.oneof).required = true;

    // ID of the disk to create the image from
    string source_disk_id = 4 [(field_behavior) = IMMUTABLE];
  }

  // CPU architecture supported by the image
  CPUArchitecture cpu_architecture = 6 [(field_behavior) = IMMUTABLE];

  // human readable name for image family
  string image_family_human_readable = 7 [(field_behavior) = IMMUTABLE];

  // list of platforms where this image is recommended to use
  repeated string recommended_platforms = 8 [(field_behavior) = IMMUTABLE];

  // list of platforms where this image is not supported with explanation
  map<string, string> unsupported_platforms = 9 [(field_behavior) = IMMUTABLE];
}

message ImageStatus {
  enum State {
    UNSPECIFIED = 0;

    CREATING = 1;

    READY = 2;

    UPDATING = 3;

    DELETING = 4;

    ERROR = 5;
  }

  State state = 1;

  string state_description = 2;

  int64 storage_size_bytes = 3;

  int64 min_disk_size_bytes = 4;

  // Indicates whether there is an ongoing operation
  bool reconciling = 5;

  // Impossible create a disk using image family after the deprecation time, but still possible to create disk using image id.
  message ImageFamilyDeprecationStatus {
    google.protobuf.Timestamp deprecated_at = 1;

    string message = 2;
  }

  ImageFamilyDeprecationStatus image_family_deprecation = 6;
}
