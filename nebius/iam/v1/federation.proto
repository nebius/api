syntax = "proto3";

package nebius.iam.v1;

import "buf/validate/validate.proto";
import "nebius/annotations.proto";
import "nebius/common/v1/metadata.proto";

option go_package = "github.com/nebius/gosdk/proto/nebius/iam/v1";
option java_multiple_files = true;
option java_outer_classname = "FederationProto";
option java_package = "ai.nebius.pub.iam.v1";

message Federation {
  common.v1.ResourceMetadata metadata = 1 [(buf.validate.field).required = true];

  FederationSpec spec = 2 [(buf.validate.field).required = true];

  FederationStatus status = 3 [(field_behavior) = OUTPUT_ONLY];
}

message FederationSpec {
  bool user_account_auto_creation = 1;

  reserved 3;

  bool active = 4 [
    deprecated = true,
    (field_deprecation_details) = {description: "'active' field ignored. Use 'Activate/Deactivate' methods to manage federation state. A newly created federation is always active by default."}
  ];

  oneof settings {
    option (buf.validate.oneof).required = true;

    SamlSettings saml_settings = 10;
  }
}

message SamlSettings {
  string idp_issuer = 1;

  string sso_url = 2;

  // if "true", the identity provider MUST authenticate the presenter directly rather than rely on a previous security context.
  bool force_authn = 3;
}

message FederationStatus {
  enum State {
    UNSPECIFIED = 0;

    ACTIVE = 1;

    INACTIVE = 2;
  }

  State state = 3;

  int32 users_count = 1;

  int32 certificates_count = 2;
}
